{
  "name": "mon+thu; 5",
  "nodes": [
    {
      "parameters": {
        "modelId": {
          "__rl": true,
          "value": "claude-haiku-4-5-20251001",
          "mode": "list",
          "cachedResultName": "claude-haiku-4-5-20251001"
        },
        "messages": {
          "values": [
            {
              "content": "You are an expert social media content creator for Tax4US, a US-Israeli tax advisory service.\n\n## TAX4US BRAND GUIDELINES:\n- **Brand Colors**: Primary Green #8fb634 (lime/olive), Secondary #a1cd3a (bright lime)\n- **Brand Voice**: Professional, trustworthy, expert yet approachable\n- **Target Audience**: US expats living in Israel, dual citizens, American investors in Israel\n- **Tone**: Authoritative but friendly, educational, value-driven\n\n‚ö†Ô∏è CRITICAL RULE: The featured image ALREADY shows the article title. Write DIFFERENT, CREATIVE text - NOT the title.\n\n---\n\n**ARTICLE INFO:**\n- Title (IN THE IMAGE - DO NOT USE): {{ $json.english_post_title || $json.title?.raw || $json.title || '' }}\n- URL (MUST INCLUDE): {{ $json.english_post_url || $json.link || 'https://tax4us.co.il' }}\n- Excerpt: {{ $json.english_post_excerpt || $json.excerpt?.raw || '' }}\n- Focus Keyword: {{ $json.focusKeyword || '' }}\n\n---\n\n**YOUR TASK:** Create a professional LinkedIn post (English only) that complements the image (which shows the title).\n\n**LINKEDIN POST REQUIREMENTS (500-700 characters):**\n\n1. **Professional Hook (First 1-2 Lines)**: Start with an insight, surprising fact, or professional question\n   - Examples: \"For US expats in Israel, navigating foreign tax credits requires careful attention...\"\n   - ‚ùå DO NOT start with the article title\n\n2. **Key Insights**: Share 2-3 valuable takeaways from the article\n   - Use ‚Üí or ‚Ä¢ for bullet points\n   - Provide real value, not just teasers\n\n3. **Expert Perspective**: Add thought leadership angle\n   - \"What many don't realize...\"\n   - \"In practice, this means...\"\n\n4. **Call-to-Action**: Professional CTA with the article URL\n   - \"Read the complete guide:\" [URL]\n\n5. **Hashtags**: Include 4-5 relevant hashtags at the end\n   - #USTax #ExpatTax #TaxPlanning #USExpats #IsraelTax #FBAR #FATCA\n\n**GOOD EXAMPLE:**\n```\nFor US expats in Israel, proper foreign tax credit filing isn't just paperwork‚Äîit's potentially thousands in savings.\n\nKey considerations:\n‚Üí Form 1116 timing matters more than most realize\n‚Üí The US-Israel tax treaty offers specific provisions many overlook\n‚Üí Documentation requirements changed in 2024\n\nWhat many don't realize is that incorrect filing can trigger IRS scrutiny years later.\n\nGet the complete breakdown: https://tax4us.co.il/article\n\n#USTax #ExpatTax #TaxPlanning #USExpats #IsraelTax\n```\n\n**BAD EXAMPLE (DO NOT DO THIS):**\n```\n7 Critical Rules for Form 1116 https://tax4us.co.il/article\n```\n\n---\n\n**OUTPUT:** Return ONLY valid JSON (no markdown, no backticks):\n\n{\"linkedin_post\": \"Your professional LinkedIn post with URL and hashtags\", \"linkedin_hashtags\": [\"#USTax\", \"#ExpatTax\", \"#TaxPlanning\", \"#USExpats\", \"#IsraelTax\"], \"key_insights\": [\"Insight 1\", \"Insight 2\", \"Insight 3\"]}\n\n**REMEMBER:**\n1. The title is ALREADY in the image - write something DIFFERENT\n2. MUST include the URL: {{ $json.english_post_url || $json.link || 'https://tax4us.co.il' }}\n3. Professional tone that reflects Tax4US brand (trustworthy, expert, helpful)\n4. Target audience: US expats in Israel\n5. Include specific IRS forms, regulations, or deadlines from the article when available"
            }
          ]
        },
        "options": {
          "maxTokens": 1024,
          "temperature": 0.7
        }
      },
      "type": "@n8n/n8n-nodes-langchain.anthropic",
      "typeVersion": 1,
      "position": [
        -3056,
        16
      ],
      "id": "7d653a3b-52f4-4173-8c54-066f38da3e61",
      "name": "Generate LinkedIn Post (English)1",
      "credentials": {
        "anthropicApi": {
          "id": "j1oGG5odUyZb049h",
          "name": "Anthropic Claude"
        }
      }
    },
    {
      "parameters": {
        "user": "tax4us",
        "platform": [
          "linkedin"
        ],
        "title": "={{ $json.linkedin_post }}",
        "photos": "={{ $json.featured_image_url || $('1').first().json.featured_image_url || '' }}",
        "targetLinkedinPageId": "urn:li:organization:17903965"
      },
      "type": "n8n-nodes-upload-post.uploadPost",
      "typeVersion": 1,
      "position": [
        -1584,
        16
      ],
      "id": "6969bce5-2ed8-4f11-b13c-4222cf6b13ac",
      "name": "Publish to LinkedIn1",
      "retryOnFail": true,
      "maxTries": 3,
      "waitBetweenTries": 5000,
      "credentials": {
        "uploadPostApi": {
          "id": "1ICWfN9LPzYDoagR",
          "name": "tax4us"
        }
      },
      "continueOnFail": true
    },
    {
      "parameters": {
        "jsCode": "// Parse and validate LinkedIn post from AI output\nconst inputData = $input.first().json;\n\nlet linkedinPost = '';\nlet linkedinHashtags = [];\nlet articleUrl = '';\nlet articleTitle = '';\nlet featuredImageUrl = '';\n\ntry {\n  const extractNode = $('1');\n  if (extractNode && extractNode.first()) {\n    const data = extractNode.first().json;\n    articleUrl = data.english_post_url || data.link || '';\n    articleTitle = data.english_post_title || '';\n    featuredImageUrl = data.featured_image_url || '';\n  }\n} catch (e) {}\n\nif (!articleUrl) {\n  articleUrl = inputData.english_post_url || inputData.link || inputData.url || 'https://tax4us.co.il';\n}\n\n// Extract AI response\nlet aiResponseText = '';\n\nif (inputData.content) {\n  aiResponseText = typeof inputData.content === 'string' ? inputData.content : JSON.stringify(inputData.content);\n} else if (inputData.text) {\n  aiResponseText = inputData.text;\n} else if (inputData.message && inputData.message.content) {\n  if (Array.isArray(inputData.message.content)) {\n    aiResponseText = inputData.message.content[0]?.text || inputData.message.content[0] || '';\n  } else {\n    aiResponseText = inputData.message.content;\n  }\n} else if (inputData.response) {\n  aiResponseText = inputData.response;\n} else if (inputData.output) {\n  aiResponseText = inputData.output;\n} else if (typeof inputData === 'string') {\n  aiResponseText = inputData;\n}\n\n// Parse JSON\nlet parsed = null;\nif (aiResponseText) {\n  let cleanText = String(aiResponseText).trim();\n  cleanText = cleanText.replace(/^```json\\s*/i, '').replace(/^```\\s*/i, '').replace(/\\s*```$/i, '');\n  \n  try {\n    parsed = JSON.parse(cleanText);\n  } catch (e) {\n    const jsonMatch = cleanText.match(/\\{[\\s\\S]*\\}/);\n    if (jsonMatch) {\n      try {\n        parsed = JSON.parse(jsonMatch[0]);\n      } catch (e2) {\n        linkedinPost = cleanText;\n      }\n    } else {\n      linkedinPost = cleanText;\n    }\n  }\n}\n\nif (!parsed && inputData.linkedin_post) {\n  parsed = inputData;\n}\n\nif (parsed) {\n  linkedinPost = parsed.linkedin_post || parsed.linkedinPost || parsed.post || '';\n  linkedinHashtags = parsed.linkedin_hashtags || parsed.hashtags || ['#USTax', '#ExpatTax', '#TaxPlanning', '#USExpats', '#IsraelTax'];\n}\n\nif (!Array.isArray(linkedinHashtags)) {\n  linkedinHashtags = ['#USTax', '#ExpatTax', '#TaxPlanning', '#USExpats', '#IsraelTax'];\n}\n\n// Generate fallback if needed\nif (!linkedinPost || linkedinPost.trim() === '') {\n  linkedinPost = 'For US expats in Israel, navigating cross-border tax obligations requires careful attention to detail.\\n\\nKey considerations:\\n- Proper form selection and timing\\n- Understanding treaty provisions\\n- Documentation requirements\\n\\nGet the complete breakdown: ' + articleUrl + '\\n\\n#USTax #ExpatTax #TaxPlanning #USExpats #IsraelTax';\n}\n\n// Ensure URL is included\nif (linkedinPost.indexOf('http') === -1) {\n  linkedinPost = linkedinPost + '\\n\\n' + articleUrl;\n}\n\n// Ensure hashtags\nif (linkedinPost.indexOf('#') === -1) {\n  linkedinPost = linkedinPost + '\\n\\n' + linkedinHashtags.join(' ');\n}\n\nreturn [{\n  json: {\n    ...inputData,\n    linkedin_post: linkedinPost,\n    linkedin_hashtags: linkedinHashtags,\n    article_url: articleUrl,\n    english_post_url: articleUrl,\n    featured_image_url: featuredImageUrl || ''\n  }\n}];"
      },
      "id": "99d72221-652a-450e-8256-5b7fb66d77bb",
      "name": "Parse LinkedIn Post1",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -2704,
        16
      ],
      "notes": "Parses, validates, and fixes social media posts - prevents title-only posts"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "li-1",
              "name": "platform",
              "value": "LinkedIn",
              "type": "string"
            },
            {
              "id": "li-2",
              "name": "post_content",
              "value": "={{ $json.linkedin_post }}",
              "type": "string"
            },
            {
              "id": "li-3",
              "name": "post_url",
              "value": "={{ $json.english_post_url || $json.article_url }}",
              "type": "string"
            },
            {
              "id": "li-4",
              "name": "image_url",
              "value": "={{ $json.featured_image_url }}",
              "type": "string"
            },
            {
              "id": "li-5",
              "name": "message",
              "value": "=üì¢ *LinkedIn Post Ready for Approval*\n\n*Post Content:*\n{{ $json.linkedin_post }}\n\n*Article URL:* {{ $json.english_post_url || $json.article_url }}\n*Image:* {{ $json.featured_image_url ? 'Attached' : 'None' }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "id": "962f96b3-0ba6-450b-ab57-42ab5aebb173",
      "name": "Format LinkedIn Approval1",
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -2480,
        16
      ]
    },
    {
      "parameters": {
        "authentication": "oAuth2",
        "operation": "sendAndWait",
        "user": {
          "__rl": true,
          "value": "U09NNMEDNEQ",
          "mode": "list",
          "cachedResultName": "ben"
        },
        "message": "={{ $json.message }}",
        "options": {}
      },
      "id": "5eca977e-794c-4296-8ec6-0024aa9827a5",
      "name": "Send LinkedIn Approval1",
      "type": "n8n-nodes-base.slack",
      "typeVersion": 2.3,
      "position": [
        -2256,
        16
      ],
      "webhookId": "ebec4211-e41b-444b-a69a-8197360ce58c",
      "credentials": {
        "slackOAuth2Api": {
          "id": "TtgEhzUDH0MsxlGp",
          "name": "Slack account"
        }
      }
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "li-fb-1",
              "name": "approved",
              "value": "={{ $json.data?.approved ?? $json.approved ?? false }}",
              "type": "boolean"
            },
            {
              "id": "li-fb-2",
              "name": "userFeedback",
              "value": "={{ $json.data?.feedback ?? $json.data?.text ?? $json.feedback ?? '' }}",
              "type": "string"
            },
            {
              "id": "li-fb-3",
              "name": "linkedin_post",
              "value": "={{ $('Format LinkedIn Approval1').first().json.post_content }}",
              "type": "string"
            },
            {
              "id": "li-fb-4",
              "name": "english_post_url",
              "value": "={{ $('Format LinkedIn Approval1').first().json.post_url }}",
              "type": "string"
            },
            {
              "id": "li-fb-5",
              "name": "featured_image_url",
              "value": "={{ $('Format LinkedIn Approval1').first().json.image_url }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "id": "f8749083-a456-4cf1-84b9-078246f54981",
      "name": "Extract LinkedIn Feedback1",
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -2032,
        16
      ]
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "version": 2,
            "leftValue": "",
            "caseSensitive": true,
            "typeValidation": "loose"
          },
          "conditions": [
            {
              "id": "li-cond-1",
              "leftValue": "={{ $json.approved }}",
              "rightValue": "",
              "operator": {
                "type": "boolean",
                "operation": "true",
                "singleValue": true
              }
            }
          ],
          "combinator": "and"
        },
        "looseTypeValidation": true,
        "options": {}
      },
      "id": "9e85d302-531d-4245-bfff-2c2a7c171f4a",
      "name": "Check LinkedIn Approval1",
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        -1808,
        16
      ]
    },
    {
      "parameters": {
        "url": "=https://tax4us.co.il/wp-json/wp/v2/posts/{{ $('Create English Draft with Video').first().json.hebrewPostId }}",
        "authentication": "predefinedCredentialType",
        "nodeCredentialType": "wordpressApi",
        "options": {
          "response": {
            "response": {
              "responseFormat": "json"
            }
          }
        }
      },
      "id": "79ed5942-c4f0-4dc5-b197-0efa1966528d",
      "name": "Fetch Hebrew Post1",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.3,
      "position": [
        -1136,
        16
      ],
      "credentials": {
        "wordpressApi": {
          "id": "S5Sr1ruBZOv5jSn5",
          "name": "Wordpress account"
        }
      },
      "continueOnFail": true
    },
    {
      "parameters": {
        "modelId": {
          "__rl": true,
          "value": "claude-haiku-4-5-20251001",
          "mode": "list",
          "cachedResultName": "claude-haiku-4-5-20251001"
        },
        "messages": {
          "values": [
            {
              "content": "=◊ê◊™◊î ◊û◊ï◊û◊ó◊î ◊ú◊™◊ï◊õ◊ü ◊°◊ï◊©◊ô◊ê◊ú ◊¢◊ë◊ï◊® Tax4US, ◊©◊ô◊®◊ï◊™ ◊ô◊ô◊¢◊ï◊• ◊û◊° ◊ô◊©◊®◊ê◊ú◊ô-◊ê◊û◊®◊ô◊ß◊ê◊ô.\n\n## ◊î◊†◊ó◊ô◊ï◊™ ◊û◊ô◊™◊ï◊í TAX4US:\n- **◊¶◊ë◊¢◊ô ◊û◊ï◊™◊í**: ◊ô◊®◊ï◊ß ◊®◊ê◊©◊ô #8fb634, ◊ô◊®◊ï◊ß ◊û◊©◊†◊ô #a1cd3a\n- **◊ß◊ï◊ú ◊î◊û◊ï◊™◊í**: ◊û◊ß◊¶◊ï◊¢◊ô, ◊ê◊û◊ô◊ü, ◊û◊ï◊û◊ó◊î ◊ê◊ö ◊†◊í◊ô◊©\n- **◊ß◊î◊ú ◊ô◊¢◊ì**: ◊ê◊û◊®◊ô◊ß◊ê◊ô◊ù ◊ë◊ô◊©◊®◊ê◊ú, ◊ë◊¢◊ú◊ô ◊ê◊ñ◊®◊ó◊ï◊™ ◊õ◊§◊ï◊ú◊î, ◊û◊©◊ß◊ô◊¢◊ô◊ù ◊ê◊û◊®◊ô◊ß◊ê◊ô◊ù ◊ë◊ô◊©◊®◊ê◊ú\n- **◊ò◊ï◊ü**: ◊°◊û◊õ◊ï◊™◊ô ◊ê◊ö ◊ô◊ì◊ô◊ì◊ï◊™◊ô, ◊ó◊ô◊†◊ï◊õ◊ô, ◊†◊ï◊™◊ü ◊¢◊®◊ö\n\n‚ö†Ô∏è ◊õ◊ú◊ú ◊ß◊®◊ô◊ò◊ô: ◊î◊™◊û◊ï◊†◊î ◊î◊û◊¶◊ï◊®◊§◊™ ◊õ◊ë◊® ◊û◊¶◊ô◊í◊î ◊ê◊™ ◊õ◊ï◊™◊®◊™ ◊î◊û◊ê◊û◊®. ◊¢◊ú◊ô◊ö ◊ú◊õ◊™◊ï◊ë ◊™◊ï◊õ◊ü ◊©◊ï◊†◊î ◊ï◊ô◊¶◊ô◊®◊™◊ô - ◊ú◊ê ◊ê◊™ ◊î◊õ◊ï◊™◊®◊™.\n\n---\n\n**◊û◊ô◊ì◊¢ ◊¢◊ú ◊î◊û◊ê◊û◊® ◊ë◊¢◊ë◊®◊ô◊™:**\n- ◊õ◊ï◊™◊®◊™ ◊¢◊ë◊®◊ô◊™ (◊ë◊™◊û◊ï◊†◊î - ◊ê◊ú ◊™◊©◊™◊û◊©): {{ $json.title?.rendered || $json.title || '' }}\n- ◊ß◊ô◊©◊ï◊® ◊¢◊ë◊®◊ô◊™: {{ $json.link || '' }}\n- ◊™◊ß◊¶◊ô◊®: {{ $json.excerpt?.rendered || '' }}\n\n**◊û◊ô◊ì◊¢ ◊¢◊ú ◊î◊û◊ê◊û◊® ◊ë◊ê◊†◊í◊ú◊ô◊™:**\n- ◊õ◊ï◊™◊®◊™ ◊ê◊†◊í◊ú◊ô◊™: {{ $('Link Polylang Translations').first().json.english_post_title || $('Link Polylang Translations').first().json.title || '' }}\n\n- ◊ß◊ô◊©◊ï◊® ◊ê◊†◊í◊ú◊ô◊™: {{ $('Link Polylang Translations').first().json.english_post_url || $('Link Polylang Translations').first().json.link || '' }}\n\n\n---\n\n**◊î◊û◊©◊ô◊û◊î ◊©◊ú◊ö:** ◊¶◊ï◊® ◊§◊ï◊°◊ò ◊§◊ô◊ô◊°◊ë◊ï◊ß ◊ì◊ï-◊ú◊©◊ï◊†◊ô ◊©◊û◊©◊ß◊£ ◊ê◊™ ◊û◊ô◊™◊ï◊í Tax4US.\n\n**◊û◊ë◊†◊î ◊î◊§◊ï◊°◊ò:**\n\n1. **◊õ◊ï◊™◊®◊™ ◊¢◊ë◊®◊ô◊™** - ◊õ◊ï◊™◊®◊™ ◊ß◊¶◊®◊î ◊ï◊û◊ï◊©◊õ◊™ ◊©◊û◊™◊ó◊ô◊ú◊î ◊ë◊©◊ê◊ú◊î ◊ê◊ï ◊¢◊ï◊ë◊ì◊î ◊û◊§◊™◊ô◊¢◊î\n   - ◊ì◊ï◊í◊û◊ê◊ï◊™: \"◊î◊ê◊ù ◊ê◊™◊ù ◊û◊©◊ú◊û◊ô◊ù ◊û◊° ◊õ◊§◊ï◊ú?\", \"◊î◊ò◊¢◊ï◊™ ◊î◊ñ◊ï ◊¢◊ï◊ú◊î...\", \"◊ê◊ú ◊™◊§◊°◊§◊°◊ï...\"\n   - ‚ùå ◊ú◊ê ◊ú◊î◊™◊ó◊ô◊ú ◊ë◊õ◊ï◊™◊®◊™ ◊î◊û◊ê◊û◊®!\n\n2. **◊õ◊ï◊™◊®◊™ ◊ê◊†◊í◊ú◊ô◊™** - ◊™◊®◊í◊ï◊ù/◊í◊®◊°◊î ◊û◊ß◊ë◊ô◊ú◊î ◊©◊ú ◊î◊õ◊ï◊™◊®◊™ ◊î◊¢◊ë◊®◊ô◊™\n\n3. **◊ò◊ô◊ñ◊® ◊ë◊¢◊ë◊®◊ô◊™** - 2-3 ◊û◊©◊§◊ò◊ô◊ù ◊©◊†◊ï◊™◊†◊ô◊ù ◊¢◊®◊ö ◊ï◊û◊ï◊©◊õ◊ô◊ù ◊ú◊ú◊ó◊ï◊•\n\n4. **◊ß◊ô◊©◊ï◊®◊ô◊ù** - ◊ó◊ï◊ë◊î ◊©◊†◊ô ◊ß◊ô◊©◊ï◊®◊ô◊ù (◊¢◊ë◊®◊ô◊™ ◊ï◊ê◊†◊í◊ú◊ô◊™):\n   - üîó ◊ú◊ß◊®◊ô◊ê◊î ◊ë◊¢◊ë◊®◊ô◊™: [URL]\n   - üîó Read in English: [URL]\n\n5. **◊ê◊ô◊û◊ï◊í'◊ô◊ù** - 2-3 ◊ê◊ô◊û◊ï◊í'◊ô◊ù ◊®◊ú◊ï◊ï◊†◊ò◊ô◊ô◊ù (üí∞ üìä üá∫üá∏üáÆüá± ‚ö†Ô∏è ‚úÖ)\n\n**◊ì◊ï◊í◊û◊î ◊ò◊ï◊ë◊î:**\n```\nüí∞ ◊î◊ê◊ù ◊ê◊™◊ù ◊û◊©◊ú◊û◊ô◊ù ◊û◊° ◊õ◊§◊ï◊ú ◊ë◊ò◊¢◊ï◊™?\nAre you accidentally paying double taxes?\n\n◊®◊ï◊ë ◊î◊ê◊û◊®◊ô◊ß◊ê◊ô◊ù ◊ë◊ô◊©◊®◊ê◊ú ◊û◊§◊°◊§◊°◊ô◊ù ◊ê◊™ ◊î◊õ◊ú◊ú ◊î◊ß◊®◊ô◊ò◊ô ◊î◊ñ◊î ◊ë◊ò◊ï◊§◊° 1116 ◊©◊ô◊õ◊ï◊ú ◊ú◊ó◊°◊ï◊ö ◊ê◊ú◊§◊ô ◊ì◊ï◊ú◊®◊ô◊ù. ◊ê◊ú ◊™◊©◊ê◊ô◊®◊ï ◊õ◊°◊£ ◊¢◊ú ◊î◊©◊ï◊ú◊ó◊ü!\n\nüîó ◊ú◊ß◊®◊ô◊ê◊î ◊ë◊¢◊ë◊®◊ô◊™: https://tax4us.co.il/he/article\nüîó Read in English: https://tax4us.co.il/en/article\n```\n\n**◊ì◊ï◊í◊û◊î ◊®◊¢◊î (◊ê◊ú ◊™◊¢◊©◊î ◊õ◊ö):**\n```\n7 ◊õ◊ú◊ú◊ô◊ù ◊ß◊®◊ô◊ò◊ô◊ô◊ù ◊ú◊û◊ô◊ú◊ï◊ô ◊ò◊ï◊§◊° 1116\nhttps://tax4us.co.il/article\n```\n\n---\n\n**◊§◊ú◊ò:** ◊î◊ó◊ñ◊® JSON ◊ë◊ú◊ë◊ì (◊ú◊ú◊ê markdown, ◊ú◊ú◊ê backticks):\n\n{\"hebrew_headline\": \"◊õ◊ï◊™◊®◊™ ◊ô◊¶◊ô◊®◊™◊ô◊™ ◊ë◊¢◊ë◊®◊ô◊™ ◊©◊û◊™◊ó◊ô◊ú◊î ◊ë◊©◊ê◊ú◊î/◊¢◊ï◊ë◊ì◊î\", \"english_headline\": \"Matching English headline\", \"hebrew_teaser\": \"◊ò◊ô◊ñ◊® ◊û◊ï◊©◊ö ◊ë◊¢◊ë◊®◊ô◊™ 2-3 ◊û◊©◊§◊ò◊ô◊ù\", \"hebrew_url\": \"◊î◊ß◊ô◊©◊ï◊® ◊ú◊û◊ê◊û◊® ◊ë◊¢◊ë◊®◊ô◊™\", \"english_url\": \"◊î◊ß◊ô◊©◊ï◊® ◊ú◊û◊ê◊û◊® ◊ë◊ê◊†◊í◊ú◊ô◊™\", \"full_post\": \"◊î◊§◊ï◊°◊ò ◊î◊û◊ú◊ê ◊û◊ï◊õ◊ü ◊ú◊§◊®◊°◊ï◊ù ◊¢◊ù ◊õ◊ú ◊î◊ê◊ú◊û◊†◊ò◊ô◊ù\"}\n\n**◊ñ◊õ◊ï◊®:**\n1. ◊î◊õ◊ï◊™◊®◊™ ◊õ◊ë◊® ◊ë◊™◊û◊ï◊†◊î - ◊õ◊™◊ï◊ë ◊û◊©◊î◊ï ◊ê◊ó◊® (◊©◊ê◊ú◊î/◊¢◊ï◊ë◊ì◊î ◊û◊§◊™◊ô◊¢◊î)\n2. ◊ó◊ô◊ô◊ë ◊ú◊õ◊ú◊ï◊ú ◊©◊†◊ô ◊î◊ß◊ô◊©◊ï◊®◊ô◊ù (◊¢◊ë◊®◊ô◊™ ◊ï◊ê◊†◊í◊ú◊ô◊™)\n3. ◊î◊ò◊ô◊ñ◊® ◊ë◊¢◊ë◊®◊ô◊™ ◊ë◊ú◊ë◊ì\n4. ◊©◊û◊ô◊®◊î ◊¢◊ú ◊û◊ô◊™◊ï◊í Tax4US - ◊û◊ß◊¶◊ï◊¢◊ô, ◊ê◊û◊ô◊ü, ◊û◊ï◊û◊ó◊î\n5. ◊î◊©◊™◊û◊© ◊ë◊ê◊ô◊û◊ï◊í'◊ô◊ù ◊ë◊¶◊ï◊®◊î ◊û◊™◊ï◊†◊î (2-3)"
            }
          ]
        },
        "options": {
          "maxTokens": 1024,
          "temperature": 0.7
        }
      },
      "id": "ec70334f-a7dd-48f5-b83d-b8e220597579",
      "name": "Generate Facebook Post (Bilingual)1",
      "type": "@n8n/n8n-nodes-langchain.anthropic",
      "typeVersion": 1,
      "position": [
        1328,
        16
      ],
      "credentials": {
        "anthropicApi": {
          "id": "j1oGG5odUyZb049h",
          "name": "Anthropic Claude"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "// Parse bilingual Facebook post from AI output\nconst inputData = $input.first().json;\n\nlet hebrewHeadline = '';\nlet hebrewTeaser = '';\nlet hebrewUrl = '';\nlet englishUrl = '';\nlet fullPost = '';\n\n// Get URLs\nhebrewUrl = inputData.link || inputData.hebrew_post_url || inputData.hebrewUrl || '';\nenglishUrl = inputData.english_post_url || inputData.englishUrl || inputData.article_url || '';\n\nif (!hebrewUrl || !englishUrl) {\n  try {\n    if (!hebrewUrl) {\n      const fetchItems = $('Fetch Hebrew Post1').all();\n      if (fetchItems && fetchItems.length > 0 && fetchItems[0].json) {\n        hebrewUrl = fetchItems[0].json.link || '';\n      }\n    }\n    if (!englishUrl) {\n      const linkItems = $('Link Polylang Translations').all();\n      if (linkItems && linkItems.length > 0 && linkItems[0].json) {\n        englishUrl = linkItems[0].json.english_post_url || linkItems[0].json.link || '';\n      }\n    }\n  } catch (e) {}\n}\n\n// Decode URLs\nif (hebrewUrl && hebrewUrl.indexOf('%') !== -1) {\n  try { hebrewUrl = decodeURIComponent(hebrewUrl); } catch (e) {}\n}\nif (englishUrl && englishUrl.indexOf('%') !== -1) {\n  try { englishUrl = decodeURIComponent(englishUrl); } catch (e) {}\n}\n\n// Extract AI response\nlet aiResponseText = '';\n\nif (inputData.content) {\n  aiResponseText = typeof inputData.content === 'string' ? inputData.content : JSON.stringify(inputData.content);\n} else if (inputData.text) {\n  aiResponseText = inputData.text;\n} else if (inputData.message && inputData.message.content) {\n  if (Array.isArray(inputData.message.content)) {\n    aiResponseText = inputData.message.content[0]?.text || inputData.message.content[0] || '';\n  } else {\n    aiResponseText = inputData.message.content;\n  }\n} else if (inputData.response) {\n  aiResponseText = inputData.response;\n} else if (inputData.output) {\n  aiResponseText = inputData.output;\n} else if (typeof inputData === 'string') {\n  aiResponseText = inputData;\n}\n\n// Parse JSON\nlet parsed = null;\nif (aiResponseText) {\n  let cleanText = String(aiResponseText).trim();\n  cleanText = cleanText.replace(/^```json\\s*/i, '').replace(/^```\\s*/i, '').replace(/\\s*```$/i, '');\n  \n  try {\n    parsed = JSON.parse(cleanText);\n  } catch (e) {\n    const jsonMatch = cleanText.match(/\\{[\\s\\S]*\\}/);\n    if (jsonMatch) {\n      try {\n        parsed = JSON.parse(jsonMatch[0]);\n      } catch (e2) {}\n    }\n  }\n}\n\nif (!parsed && inputData.hebrew_headline) {\n  parsed = inputData;\n}\n\nif (parsed) {\n  hebrewHeadline = parsed.hebrew_headline || '';\n  hebrewTeaser = parsed.hebrew_teaser || '';\n  if (!hebrewUrl && parsed.hebrew_url) hebrewUrl = parsed.hebrew_url;\n  if (!englishUrl && parsed.english_url) englishUrl = parsed.english_url;\n}\n\n// Fallbacks\nif (!hebrewHeadline) {\n  hebrewHeadline = '◊ó◊ì◊©◊ï◊™ ◊û◊° ◊ó◊©◊ï◊ë◊ï◊™ ◊ú◊ê◊û◊®◊ô◊ß◊ê◊ô◊ù ◊ë◊ô◊©◊®◊ê◊ú';\n}\n\nif (!hebrewTeaser) {\n  hebrewTeaser = '◊ú◊û◊ô◊ì◊¢ ◊†◊ï◊°◊£ ◊ß◊®◊ê◊ï ◊ê◊™ ◊î◊û◊ê◊û◊® ◊î◊û◊ú◊ê.';\n}\n\n// Build full post\nfullPost = hebrewHeadline + '\\n\\n' + hebrewTeaser + '\\n\\n' + '◊ú◊ß◊®◊ô◊ê◊î ◊ë◊¢◊ë◊®◊ô◊™: ' + hebrewUrl + '\\nRead in English: ' + englishUrl;\n\nreturn [{\n  json: {\n    ...inputData,\n    hebrew_headline: hebrewHeadline,\n    hebrew_teaser: hebrewTeaser,\n    hebrew_url: hebrewUrl,\n    english_url: englishUrl,\n    facebook_post: fullPost\n  }\n}];"
      },
      "id": "02ef0a9a-482e-4bcc-af79-2e437382c128",
      "name": "Parse Facebook Post (Bilingual)1",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        1680,
        -64
      ]
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "slack_message",
              "name": "=slack_message",
              "value": "=üì¢ *◊§◊ï◊°◊ò ◊§◊ô◊ô◊°◊ë◊ï◊ß ◊ó◊ì◊© ◊ú◊ê◊ô◊©◊ï◊®*\\n\\nüáÆüá± *◊õ◊ï◊™◊®◊™ ◊¢◊ë◊®◊ô◊™:*\\n{{ $json.hebrew_headline }}\\n\\nüá∫üá∏ *English Headline:*\\n{{ $json.english_headline }}\\n\\n‚úçÔ∏è *◊ò◊ô◊ñ◊® ◊ë◊¢◊ë◊®◊ô◊™:*\\n{{ $json.hebrew_teaser }}\\n\\nüîó *◊ß◊ô◊©◊ï◊®◊ô◊ù:*\\n‚Ä¢ ◊¢◊ë◊®◊ô◊™: {{ $json.hebrew_url }}\\n‚Ä¢ English: {{ $json.english_url }}\\n\\n---\\n*◊™◊¶◊ï◊í◊î ◊û◊ß◊ì◊ô◊û◊î ◊©◊ú ◊î◊§◊ï◊°◊ò:*\\n```\\n{{ $json.facebook_post }}\\n```",
              "type": "string"
            },
            {
              "id": "approval_type",
              "name": "approval_type",
              "value": "facebook_bilingual",
              "type": "string"
            },
            {
              "id": "hebrew_headline",
              "name": "hebrew_headline",
              "value": "={{ $json.hebrew_headline }}",
              "type": "string"
            },
            {
              "id": "english_headline",
              "name": "english_headline",
              "value": "={{ $json.english_headline }}",
              "type": "string"
            },
            {
              "id": "hebrew_teaser",
              "name": "hebrew_teaser",
              "value": "={{ $json.hebrew_teaser }}",
              "type": "string"
            },
            {
              "id": "hebrew_url",
              "name": "hebrew_url",
              "value": "={{ $json.hebrew_url }}",
              "type": "string"
            },
            {
              "id": "english_url",
              "name": "english_url",
              "value": "={{ $json.english_url }}",
              "type": "string"
            },
            {
              "id": "facebook_post",
              "name": "facebook_post",
              "value": "={{ $json.facebook_post }}",
              "type": "string"
            }
          ]
        },
        "includeOtherFields": true,
        "options": {}
      },
      "id": "bea38bf5-519e-4d87-b2f8-d17f7736ba73",
      "name": "Format Facebook Approval1",
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        1904,
        -64
      ]
    },
    {
      "parameters": {
        "authentication": "oAuth2",
        "operation": "sendAndWait",
        "user": {
          "__rl": true,
          "value": "U09NNMEDNEQ",
          "mode": "list",
          "cachedResultName": "ben"
        },
        "message": "={{ $json.slack_message }}",
        "options": {}
      },
      "id": "08035712-9648-423c-a9b8-b3d006844205",
      "name": "Send Facebook Approval1",
      "type": "n8n-nodes-base.slack",
      "typeVersion": 2.3,
      "position": [
        2128,
        -64
      ],
      "webhookId": "883bb905-ea8a-47bb-bf05-2d7afa41423c",
      "credentials": {
        "slackOAuth2Api": {
          "id": "TtgEhzUDH0MsxlGp",
          "name": "Slack account"
        }
      }
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "fb-fb-1",
              "name": "approved",
              "value": "={{ $json.data?.approved ?? $json.approved ?? false }}",
              "type": "boolean"
            },
            {
              "id": "fb-fb-2",
              "name": "userFeedback",
              "value": "={{ $json.data?.feedback ?? $json.data?.text ?? $json.feedback ?? '' }}",
              "type": "string"
            },
            {
              "id": "fb-fb-3",
              "name": "facebook_post",
              "value": "={{ $('Format Facebook Approval1').first().json.facebook_post }}",
              "type": "string"
            },
            {
              "id": "fb-fb-4",
              "name": "hebrew_url",
              "value": "={{ $('Format Facebook Approval1').first().json.hebrew_url }}",
              "type": "string"
            },
            {
              "id": "fb-fb-5",
              "name": "english_url",
              "value": "={{ $('Format Facebook Approval1').first().json.english_url }}",
              "type": "string"
            },
            {
              "id": "fb-fb-6",
              "name": "featured_image_url",
              "value": "={{ $('1').first().json.featured_image_url || $('1').first().json.image_url || '' }}",
              "type": "string"
            },
            {
              "id": "a329c4a9-99fd-48dd-987c-b38aa2aa5033",
              "name": "video_url",
              "value": "={{ $('Prepare Sora Upload').first().json.video_url || '' }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "id": "649e6fab-44a6-41d0-b391-8fb2e9a8ab86",
      "name": "Extract Facebook Feedback1",
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        2352,
        -64
      ]
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "version": 2,
            "leftValue": "",
            "caseSensitive": true,
            "typeValidation": "loose"
          },
          "conditions": [
            {
              "id": "fb-cond-1",
              "leftValue": "={{ $json.approved }}",
              "rightValue": "",
              "operator": {
                "type": "boolean",
                "operation": "true",
                "singleValue": true
              }
            }
          ],
          "combinator": "and"
        },
        "looseTypeValidation": true,
        "options": {}
      },
      "id": "76001d72-ca0a-4564-a27a-2ad9809bdfec",
      "name": "Check Facebook Approval1",
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        2576,
        16
      ]
    },
    {
      "parameters": {
        "operation": "uploadVideo",
        "user": "tax4us",
        "platform": [
          "facebook"
        ],
        "title": "={{ $json.facebook_post }}",
        "video": "={{ $json.video_url }}",
        "facebookPageId": "844266372343077"
      },
      "id": "e73fb309-159d-47e1-8052-9a1c807a315b",
      "name": "Publish to Facebook1",
      "type": "n8n-nodes-upload-post.uploadPost",
      "typeVersion": 1,
      "position": [
        3024,
        16
      ],
      "retryOnFail": true,
      "maxTries": 3,
      "waitBetweenTries": 5000,
      "credentials": {
        "uploadPostApi": {
          "id": "1ICWfN9LPzYDoagR",
          "name": "tax4us"
        }
      },
      "continueOnFail": true
    },
    {
      "parameters": {
        "amount": 30
      },
      "id": "e7ded6d4-ca4c-42ef-a6e5-34f10f753055",
      "name": "Wait 30s (Rate Limit)1",
      "type": "n8n-nodes-base.wait",
      "typeVersion": 1.1,
      "position": [
        2800,
        16
      ],
      "webhookId": "2337a28f-6f7b-4478-b912-0c2e6f6c2cb6"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "version": 2,
            "leftValue": "",
            "caseSensitive": true,
            "typeValidation": "loose"
          },
          "conditions": [
            {
              "id": "wednesday-check",
              "leftValue": "={{ $now.weekday === 3 }}",
              "rightValue": "",
              "operator": {
                "type": "boolean",
                "operation": "true",
                "singleValue": true
              }
            }
          ],
          "combinator": "and"
        },
        "looseTypeValidation": true,
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        3248,
        16
      ],
      "id": "7ddcf1d9-83e6-41ae-9101-7475a9a953ac",
      "name": "Wednesday?1"
    },
    {
      "parameters": {
        "workflowId": {
          "__rl": true,
          "value": "fe6SYUqoC5VhyMtd",
          "mode": "list",
          "cachedResultUrl": "/workflow/fe6SYUqoC5VhyMtd",
          "cachedResultName": "WF: AI Agent Podcast Producer v3"
        },
        "workflowInputs": {
          "mappingMode": "defineBelow",
          "value": {},
          "matchingColumns": [],
          "schema": [],
          "attemptToConvertTypes": false,
          "convertFieldsToString": true
        },
        "options": {
          "waitForSubWorkflow": false
        }
      },
      "type": "n8n-nodes-base.executeWorkflow",
      "typeVersion": 1.3,
      "position": [
        3472,
        16
      ],
      "id": "85d3a068-36ed-40c1-9875-f996cd0afd4b",
      "name": "Call 'WF: AI Agent Podcast Producer v3'"
    },
    {
      "parameters": {
        "jsCode": "// Generate Video Concept for Sora 2 Pro Storyboard\n// Creates storyboard concept based on article content\n\nconst hebrewPost = $input.first().json;\n\n// Get English post data\nlet englishData = {};\ntry {\n  englishData = $('Link Polylang Translations').first()?.json || {};\n} catch (e) {}\n\n// Get featured image URL\nlet featuredImageUrl = '';\ntry {\n  const extractData = $('1').first()?.json || {};\n  featuredImageUrl = extractData.featured_image_url || '';\n} catch (e) {}\n\n// Extract article topic for video concept\nconst title = englishData.title?.raw || englishData.title || hebrewPost.title?.rendered || '';\nconst excerpt = englishData.excerpt?.raw || hebrewPost.excerpt?.rendered || '';\n\n// Clean text\nconst cleanTitle = title.replace(/<[^>]*>/g, '').trim();\nconst cleanExcerpt = excerpt.replace(/<[^>]*>/g, '').trim();\n\n// Determine video theme based on content\nconst contentLower = (cleanTitle + ' ' + cleanExcerpt).toLowerCase();\n\nlet videoTheme = 'professional-finance';\nlet colorScheme = 'green-corporate'; // Tax4US brand\n\nif (contentLower.includes('fbar') || contentLower.includes('foreign')) {\n  videoTheme = 'international-business';\n} else if (contentLower.includes('real estate') || contentLower.includes('property')) {\n  videoTheme = 'real-estate';\n} else if (contentLower.includes('crypto') || contentLower.includes('bitcoin')) {\n  videoTheme = 'technology-finance';\n} else if (contentLower.includes('retirement') || contentLower.includes('pension')) {\n  videoTheme = 'retirement-planning';\n} else if (contentLower.includes('business') || contentLower.includes('llc')) {\n  videoTheme = 'business-corporate';\n}\n\n// Video parameters\nconst videoConfig = {\n  duration: '10', // 10 seconds - optimal for social media\n  aspectRatio: 'portrait', // Better for Facebook/Instagram\n  theme: videoTheme,\n  brandColors: ['#8fb634', '#a1cd3a', '#ffffff', '#333333']\n};\n\nconsole.log('Video concept generated:');\nconsole.log('- Theme:', videoTheme);\nconsole.log('- Duration:', videoConfig.duration + 's');\nconsole.log('- Featured image:', featuredImageUrl ? 'Available' : 'None');\n\nreturn [{\n  json: {\n    ...hebrewPost,\n    videoConfig: videoConfig,\n    featuredImageUrl: featuredImageUrl,\n    articleTitle: cleanTitle,\n    articleExcerpt: cleanExcerpt,\n    englishPostUrl: englishData.link || '',\n    hebrewPostUrl: hebrewPost.link || ''\n  }\n}];"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -912,
        16
      ],
      "id": "898c10f3-a0bc-4c4f-b229-9ead5bfd80a6",
      "name": "Generate Video Concept"
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://api.kie.ai/api/v1/jobs/createTask",
        "authentication": "genericCredentialType",
        "genericAuthType": "httpHeaderAuth",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "Authorization",
              "value": "Bearer 3ca74c96d52beaef45650eb629876245"
            }
          ]
        },
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={{ (() => {\n  const title = $json.articleTitle || '';\n  const excerpt = $json.articleExcerpt || '';\n  const videoPrompt = 'Professional tax and financial services social media video for: \"' + title + '\". Style: Modern corporate, clean motion graphics, subtle animations, professional green (#8fb634) and white tones, abstract financial elements, documents and charts. Vertical format for Facebook/Instagram. No text overlay. Looping background video.';\n\n  return {\n    \"model\": \"sora-2-pro-text-to-video\",\n    \"input\": {\n      \"prompt\": videoPrompt,\n      \"aspect_ratio\": \"portrait\",\n      \"n_frames\": \"10\",\n      \"size\": \"standard\",\n      \"remove_watermark\": true,\n      \"upload_method\": \"s3\"\n    }\n  };\n})() }}",
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        -688,
        16
      ],
      "id": "c86548f3-100a-42f8-9f78-66e391736ae5",
      "name": "Create Sora Video Task",
      "credentials": {
        "httpHeaderAuth": {
          "id": "rw2YQwhMViQcDz7g",
          "name": "kie.ai"
        }
      },
      "onError": "continueRegularOutput"
    },
    {
      "parameters": {
        "url": "=https://api.kie.ai/api/v1/jobs/recordInfo?taskId={{ $json.taskId || $json.data.taskId }}",
        "authentication": "genericCredentialType",
        "genericAuthType": "httpHeaderAuth",
        "options": {
          "timeout": 30000
        }
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.3,
      "position": [
        -464,
        -64
      ],
      "id": "44b2ee5e-bd0d-41c9-a77b-e0506ec8db65",
      "name": "Get Sora Video Status",
      "credentials": {
        "httpHeaderAuth": {
          "id": "rw2YQwhMViQcDz7g",
          "name": "kie.ai"
        }
      },
      "onError": "continueRegularOutput"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "version": 2,
            "leftValue": "",
            "caseSensitive": true,
            "typeValidation": "loose"
          },
          "conditions": [
            {
              "id": "1",
              "leftValue": "={{ $json.data.state }}",
              "operator": {
                "type": "string",
                "operation": "equals"
              },
              "rightValue": "success"
            }
          ],
          "combinator": "or"
        },
        "looseTypeValidation": true,
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        -240,
        -128
      ],
      "id": "a9bbee70-98a6-4c73-aa77-bf4f93857be0",
      "name": "sora Ready?"
    },
    {
      "parameters": {
        "amount": 15
      },
      "type": "n8n-nodes-base.wait",
      "typeVersion": 1.1,
      "position": [
        -16,
        48
      ],
      "id": "7e794f1d-ccae-470a-84c5-b97e44eb1ba3",
      "name": "Wait 15s for Video",
      "webhookId": "431d0084-006c-4bbf-a7c4-cf0485a2d0a4"
    },
    {
      "parameters": {
        "url": "={{ $json.videoUrl }}",
        "authentication": "genericCredentialType",
        "genericAuthType": "httpHeaderAuth",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "Authorization",
              "value": "Bearer 3ca74c96d52beaef45650eb629876245"
            }
          ]
        },
        "options": {
          "response": {
            "response": {
              "responseFormat": "file"
            }
          }
        }
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        -16,
        -176
      ],
      "id": "ea261f40-2da9-4af3-b3b3-a4dd7c71c3be",
      "name": "Download sora",
      "credentials": {
        "httpHeaderAuth": {
          "id": "rw2YQwhMViQcDz7g",
          "name": "kie.ai"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "// Prepare Sora Upload - Passes video binary + metadata forward for Facebook post flow\n\nconst input = $input.first();\n\n// Get video URL from Check Sora Video Status\nlet videoUrl = '';\ntry {\n  videoUrl = $('Check Sora Video Status').first()?.json?.videoUrl || '';\n} catch (e) {}\n\n// If no videoUrl from node, try to extract from Download sora response headers or URL\nif (!videoUrl && input.json?.url) {\n  videoUrl = input.json.url;\n}\n\n// Get article data from Generate Video Concept\nlet articleData = {};\ntry {\n  articleData = $('Generate Video Concept').first()?.json || {};\n} catch (e) {}\n\n// Get featured image URL\nlet featuredImageUrl = '';\ntry {\n  featuredImageUrl = $('1').first()?.json?.featured_image_url || '';\n} catch (e) {}\n\n// Get English post data\nlet englishPostUrl = '';\nlet englishPostTitle = '';\ntry {\n  const linkData = $('Link Polylang Translations').first()?.json || {};\n  englishPostUrl = linkData.link || '';\n  englishPostTitle = linkData.title?.raw || linkData.title?.rendered || linkData.title || '';\n} catch (e) {}\n\n// Get Hebrew post data\nlet hebrewPostUrl = articleData.hebrewPostUrl || articleData.link || '';\n\nconsole.log('Sora Upload prepared:');\nconsole.log('- Video URL:', videoUrl ? videoUrl.substring(0, 80) + '...' : 'MISSING');\nconsole.log('- Featured image:', featuredImageUrl ? 'Available' : 'None');\nconsole.log('- English URL:', englishPostUrl);\nconsole.log('- Hebrew URL:', hebrewPostUrl);\n\nconst output = {\n  json: {\n    video_url: videoUrl,\n    featured_image_url: featuredImageUrl,\n    english_post_url: englishPostUrl,\n    english_post_title: englishPostTitle,\n    hebrew_post_url: hebrewPostUrl,\n    article_title: articleData.articleTitle || englishPostTitle || '',\n    article_excerpt: articleData.articleExcerpt || ''\n  }\n};\n\n// Pass through binary if available (downloaded video file)\nif (input.binary?.data) {\n  output.binary = { data: input.binary.data };\n}\n\nreturn [output];"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        208,
        -176
      ],
      "id": "728490cd-8c9b-4e69-bae7-a25c3cb5889d",
      "name": "Prepare Sora Upload",
      "notesInFlow": true,
      "notes": "KEPT: Binary data handling"
    },
    {
      "parameters": {
        "authentication": "oAuth2",
        "operation": "sendAndWait",
        "user": {
          "__rl": true,
          "value": "U09NNMEDNEQ",
          "mode": "list",
          "cachedResultName": "ben"
        },
        "message": "={{ $json.slackMessage }}",
        "approvalOptions": {
          "values": {
            "approvalType": "double",
            "approveLabel": "Approve Video",
            "disapproveLabel": "‚úèÔ∏è Modify Video"
          }
        },
        "options": {
          "appendAttribution": false
        }
      },
      "id": "e4f68efe-0129-4308-9e1d-6cefe1a08a5c",
      "name": "Send Video Approval Request",
      "type": "n8n-nodes-base.slack",
      "typeVersion": 2.3,
      "position": [
        656,
        -176
      ],
      "webhookId": "f13f14a5-3f92-4824-b5da-0b061f721728",
      "credentials": {
        "slackOAuth2Api": {
          "id": "TtgEhzUDH0MsxlGp",
          "name": "Slack account"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 3
          },
          "conditions": [
            {
              "id": "8a2e18e7-2d02-481d-b22c-b1539d43b0e3",
              "leftValue": "={{ $json.approved }}",
              "rightValue": "",
              "operator": {
                "type": "boolean",
                "operation": "true",
                "singleValue": true
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.3,
      "position": [
        1104,
        16
      ],
      "id": "29eb4bb9-1bde-4244-ae63-90922f31b55d",
      "name": "Video Approved?"
    },
    {
      "parameters": {
        "mode": "raw",
        "jsonOutput": "={\n  \"show_id\": \"45191a59-cf43-4867-83e7-cc2de0c5e780\",\n  \"season\": 1,\n  \"english_post_id\": \"{{ String($('Link Polylang Translations').first().json.id ?? '') }}\",\n  \"english_post_title\": \"{{ $('Create English Draft with Video').first().json.title ?? $('Extract Image URL1').first().json.english_post_title ?? '' }}\",\n  \"english_post_content\": \"{{ $('Create English Draft with Video').first().json.content ?? '' }}\",\n  \"english_post_url\": \"{{ $('Link Polylang Translations').first().json.link ?? $('Extract Image URL1').first().json.english_post_url ?? '' }}\"\n}",
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -1360,
        16
      ],
      "id": "86b790c9-03e0-43cd-905a-2974ab7bdf6d",
      "name": "Prepare Podcast Data"
    },
    {
      "parameters": {
        "mode": "raw",
        "jsonOutput": "={\n  \"title\": \"{{ $json.articleTitle ?? $json.englishPostTitle ?? 'Untitled' }}\",\n  \"videoUrl\": \"{{ $json.videoUrl ?? $json.video_url ?? '' }}\",\n  \"englishPostUrl\": \"{{ $json.englishPostUrl ?? $json.english_post_url ?? '' }}\",\n  \"hebrewPostUrl\": \"{{ $json.hebrewPostUrl ?? $json.hebrew_post_url ?? '' }}\",\n  \"featuredImageUrl\": \"{{ $json.featuredImageUrl ?? $json.featured_image_url ?? '' }}\",\n  \"slackMessage\": \"üé¨ *Video Approval Needed*\\n\\n*Title:* {{ $json.articleTitle ?? $json.englishPostTitle ?? 'Untitled' }}\\n*Video:* {{ $json.videoUrl ?? $json.video_url ?? 'MISSING VIDEO URL' }}\\n{{ $json.featuredImageUrl ? '*Thumbnail:* ' + $json.featuredImageUrl : '' }}\\n\\n*English Post:* {{ $json.englishPostUrl ?? $json.english_post_url ?? 'N/A' }}\\n*Hebrew Post:* {{ $json.hebrewPostUrl ?? $json.hebrew_post_url ?? 'N/A' }}\\n\\nReply with edits in the feedback box if needed.\"\n}",
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        432,
        -176
      ],
      "id": "d8e1bd2a-2b61-4213-af99-be37c704e3e2",
      "name": "Format Video Approval Message"
    },
    {
      "parameters": {
        "mode": "raw",
        "jsonOutput": "={\n  \"approved\": \"{{ $json.data?.approved ?? $json.approved ?? false }}\",\n  \"userFeedback\": \"{{ $json.data?.feedback ?? $json.data?.text ?? $json.feedback ?? '' }}\",\n  \"decision\": \"{{ ($json.data?.approved ?? $json.approved ?? false) ? 'approve' : 'modify' }}\",\n  \"videoUrl\": \"{{ $('Format Video Approval Message').first().json.videoUrl ?? '' }}\",\n  \"title\": \"{{ $('Format Video Approval Message').first().json.title ?? '' }}\",\n  \"englishPostUrl\": \"{{ $('Format Video Approval Message').first().json.englishPostUrl ?? '' }}\",\n  \"hebrewPostUrl\": \"{{ $('Format Video Approval Message').first().json.hebrewPostUrl ?? '' }}\",\n  \"featuredImageUrl\": \"{{ $('Format Video Approval Message').first().json.featuredImageUrl ?? '' }}\"\n}",
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        880,
        -176
      ],
      "id": "f3113e22-2bca-4488-96bf-0c0adcd9fa34",
      "name": "Process Video Approval"
    },
    {
      "parameters": {
        "inputSource": "passthrough"
      },
      "type": "n8n-nodes-base.executeWorkflowTrigger",
      "typeVersion": 1.1,
      "position": [
        -3280,
        112
      ],
      "id": "674c2a27-d981-4e49-b097-37947a6cd7d6",
      "name": "When Executed by Another Workflow"
    },
    {
      "parameters": {
        "public": true,
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.chatTrigger",
      "typeVersion": 1.4,
      "position": [
        -3280,
        -80
      ],
      "id": "f1aa4e49-e5e8-4b17-87a9-b0943f4ad944",
      "name": "When chat message received",
      "webhookId": "49cb3130-b119-4511-8843-e08ac8c6fc17"
    }
  ],
  "pinData": {},
  "connections": {
    "Generate LinkedIn Post (English)1": {
      "main": [
        [
          {
            "node": "Parse LinkedIn Post1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Publish to LinkedIn1": {
      "main": [
        [
          {
            "node": "Prepare Podcast Data",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Parse LinkedIn Post1": {
      "main": [
        [
          {
            "node": "Format LinkedIn Approval1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Format LinkedIn Approval1": {
      "main": [
        [
          {
            "node": "Send LinkedIn Approval1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Send LinkedIn Approval1": {
      "main": [
        [
          {
            "node": "Extract LinkedIn Feedback1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Extract LinkedIn Feedback1": {
      "main": [
        [
          {
            "node": "Check LinkedIn Approval1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Check LinkedIn Approval1": {
      "main": [
        [
          {
            "node": "Publish to LinkedIn1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Fetch Hebrew Post1": {
      "main": [
        [
          {
            "node": "Generate Video Concept",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Generate Facebook Post (Bilingual)1": {
      "main": [
        [
          {
            "node": "Parse Facebook Post (Bilingual)1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Parse Facebook Post (Bilingual)1": {
      "main": [
        [
          {
            "node": "Format Facebook Approval1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Format Facebook Approval1": {
      "main": [
        [
          {
            "node": "Send Facebook Approval1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Send Facebook Approval1": {
      "main": [
        [
          {
            "node": "Extract Facebook Feedback1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Extract Facebook Feedback1": {
      "main": [
        [
          {
            "node": "Check Facebook Approval1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Check Facebook Approval1": {
      "main": [
        [
          {
            "node": "Wait 30s (Rate Limit)1",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Generate Facebook Post (Bilingual)1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Publish to Facebook1": {
      "main": [
        [
          {
            "node": "Wednesday?1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Wait 30s (Rate Limit)1": {
      "main": [
        [
          {
            "node": "Publish to Facebook1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Wednesday?1": {
      "main": [
        [
          {
            "node": "Call 'WF: AI Agent Podcast Producer v3'",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Generate Video Concept": {
      "main": [
        [
          {
            "node": "Create Sora Video Task",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Create Sora Video Task": {
      "main": [
        [
          {
            "node": "Get Sora Video Status",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get Sora Video Status": {
      "main": [
        [
          {
            "node": "sora Ready?",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "sora Ready?": {
      "main": [
        [
          {
            "node": "Download sora",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Wait 15s for Video",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Wait 15s for Video": {
      "main": [
        [
          {
            "node": "Get Sora Video Status",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Download sora": {
      "main": [
        [
          {
            "node": "Prepare Sora Upload",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Prepare Sora Upload": {
      "main": [
        [
          {
            "node": "Format Video Approval Message",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Send Video Approval Request": {
      "main": [
        [
          {
            "node": "Process Video Approval",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Video Approved?": {
      "main": [
        [
          {
            "node": "Generate Facebook Post (Bilingual)1",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Create Sora Video Task",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Prepare Podcast Data": {
      "main": [
        [
          {
            "node": "Fetch Hebrew Post1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Format Video Approval Message": {
      "main": [
        [
          {
            "node": "Send Video Approval Request",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Process Video Approval": {
      "main": [
        [
          {
            "node": "Video Approved?",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "When Executed by Another Workflow": {
      "main": [
        [
          {
            "node": "Generate LinkedIn Post (English)1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "When chat message received": {
      "main": [
        [
          {
            "node": "Generate LinkedIn Post (English)1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "active": true,
  "settings": {
    "executionOrder": "v1",
    "binaryMode": "separate",
    "availableInMCP": true,
    "timeSavedMode": "fixed",
    "callerPolicy": "workflowsFromSameOwner"
  },
  "versionId": "c450da88-905a-4d78-bd23-c10720e66fe2",
  "meta": {
    "instanceId": "debc7feccc354e86e5a53344362b691cecb5d65ac2ba67b45cdccf9a516514d6"
  },
  "id": "kRFJ8kjsj0dkmBcLkFZT1",
  "tags": []
}